<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VWX5EMQSLM"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-VWX5EMQSLM');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CO₂ emissions charts by ship type, company, and country. Visual breakdown of maritime pollution in European waters.">
    <meta name="keywords" content="ship emissions chart, CO2 by ship type, shipping company emissions, maritime emissions by country, vessel pollution data">
    <meta name="author" content="Dirtiest Ships">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://dirtiestships.com/charts.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://dirtiestships.com/charts.html">
    <meta property="og:title" content="CO₂ Emissions Charts – Ship Type, Company, Country">
    <meta property="og:description" content="Visual breakdown of maritime CO₂ emissions by ship type, company, and flag state.">
    <meta property="og:site_name" content="Dirtiest Ships">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://dirtiestships.com/charts.html">
    <meta name="twitter:title" content="CO₂ Emissions Charts – Ship Type, Company, Country">
    <meta name="twitter:description" content="Visual breakdown of maritime CO₂ emissions by ship type, company, and flag state.">

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9641573711172527"
     crossorigin="anonymous"></script>
    <title>CO₂ Emissions Charts – By Type, Company & Country | DirtiestShips</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .chart-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .chart-tab {
            padding: 10px 25px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 5px;
            color: #888;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
        }
        .chart-tab:hover {
            background: rgba(78, 205, 196, 0.2);
            color: #fff;
        }
        .chart-tab.active {
            background: #4ecdc4;
            color: #1a1a2e;
            border-color: #4ecdc4;
            font-weight: bold;
        }
        .chart-note {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="images/ship-smoke-left.jpg" alt="" class="header-img header-img-left">
            <img src="images/ship-smoke-right.jpg" alt="" class="header-img header-img-right">
            <h1>Dirtiest Ships <span style="font-size: 0.5em; font-weight: normal;">(in Europe)</span></h1>
            <p class="subtitle" id="subtitle">CO2-eq Emissions by Ship Type (2024)</p>
            <nav>
                <div class="year-selector">
                    <select id="year-select">
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                        <option value="2021">2021</option>
                        <option value="2020">2020</option>
                    </select>
                </div>
                <a href="index.html">Rankings</a>
                <a href="charts.html" class="active">Charts</a>
                <a href="compare.html">Compare</a>
                <a href="cii.html">CII Ratings</a>
                <a href="news.html">News</a>
                <a href="FAQ.html">Why?</a>
            </nav>
        </header>

        <div class="chart-tabs">
            <button class="chart-tab active" data-view="type">By Ship Type</button>
            <button class="chart-tab" data-view="company">By Company</button>
            <button class="chart-tab" data-view="country">By Country</button>
        </div>

        <div class="chart-container">
            <div class="chart-wrapper">
                <canvas id="chart"></canvas>
            </div>
            <div class="chart-note" id="chart-note"></div>
        </div>

        <div class="chart-container" id="company-list-container" style="display: none;">
            <h3 style="color: #4ecdc4; margin-bottom: 20px;">All Companies by CO2-eq Emissions</h3>
            <div class="controls">
                <div class="search-box">
                    <input type="text" id="company-search" placeholder="Search companies...">
                </div>
            </div>
            <div class="table-container">
                <table id="company-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Company</th>
                            <th>CO2-eq (tonnes)</th>
                            <th>Ships</th>
                        </tr>
                    </thead>
                    <tbody id="company-tbody">
                    </tbody>
                </table>
            </div>
            <div class="pagination" id="company-pagination"></div>
        </div>

        <div class="chart-container" id="country-list-container" style="display: none;">
            <h3 style="color: #4ecdc4; margin-bottom: 20px;" id="country-list-title">Top 20 Countries by CO2-eq Emissions</h3>
            <div class="table-container">
                <table id="country-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Country</th>
                            <th id="country-co2-header">CO2-eq (tonnes)</th>
                            <th>Ships</th>
                        </tr>
                    </thead>
                    <tbody id="country-tbody">
                    </tbody>
                </table>
            </div>
        </div>

        <footer>
            <div class="footer-links">
                <a href="FAQ.html">FAQ</a>
                <a href="rules.html">Regulations</a>
                <a href="disclaimer.html">Disclaimer</a>
                <a href="mailto:hello@dirtiestships.com">hello@dirtiestships.com</a>
            </div>
            <p>Data source: <a href="https://mrv.emsa.europa.eu/" target="_blank">EU MRV Regulation</a></p>
            <p>This data shows annual CO2 emissions from ships calling at EU/EEA ports.</p>
        </footer>
    </div>

    <script>
        let chart = null;
        let currentView = 'type';
        let currentYear = '2024';

        // Company list state
        let allCompanies = [];
        let filteredCompanies = [];
        const ROWS_PER_PAGE = 50;
        let companyPage = 1;

        const notes = {
            type: '',
            company: '<strong>Note:</strong> Companies are consolidated where the same parent company reports under multiple subsidiaries. For example, MSC Group includes MSC Shipmanagement Ltd, Mediterranean Shipping Co, and MSC Cruises.',
            country: '<strong>Note:</strong> Country refers to the flag state (port of registry), not the ship\'s operating region or company nationality. Major flag states like Liberia, Marshall Islands, and Panama are popular "flags of convenience" used by international shipping companies.'
        };

        const viewConfig = {
            type: {
                file: (year) => `json/${year}_ships_by_type.json`,
                labelField: 'type',
                title: (year, co2Label) => `${co2Label} Emissions by Ship Type (${year})`,
                available: ['2024', '2023', '2022', '2021', '2020']
            },
            company: {
                file: (year) => `json/${year}_companies_top15.json`,
                labelField: 'company',
                title: (year, co2Label) => `Top 15 Companies by ${co2Label} Emissions (${year})`,
                available: ['2024']
            },
            country: {
                file: (year) => `json/${year}_countries_top20.json`,
                labelField: 'country',
                title: (year, co2Label) => `Top 20 Countries by ${co2Label} Emissions (${year})`,
                available: ['2024', '2023', '2022', '2021', '2020']
            }
        };

        const colors = [
            '#ff6b6b', '#4ecdc4', '#ffe66d', '#95e1d3', '#f38181',
            '#aa96da', '#fcbad3', '#a8d8ea', '#ff9a3c', '#1fab89',
            '#62d2a2', '#9df3c4', '#d7fbe8', '#f9ed69', '#f08a5d',
            '#b83b5e', '#6a2c70', '#c9b1ff', '#5c969e', '#ffc75f'
        ];

        // European countries with annual CO2 emissions (2023 EEA data, in tonnes)
        const europeanCountryEmissions = [
            { name: 'Malta', flag: '\u{1F1F2}\u{1F1F9}', co2: 2100000, isCountry: true },
            { name: 'Iceland', flag: '\u{1F1EE}\u{1F1F8}', co2: 3500000, isCountry: true },
            { name: 'Cyprus', flag: '\u{1F1E8}\u{1F1FE}', co2: 7200000, isCountry: true },
            { name: 'Luxembourg', flag: '\u{1F1F1}\u{1F1FA}', co2: 8100000, isCountry: true },
            { name: 'Latvia', flag: '\u{1F1F1}\u{1F1FB}', co2: 8400000, isCountry: true },
            { name: 'Estonia', flag: '\u{1F1EA}\u{1F1EA}', co2: 10500000, isCountry: true },
            { name: 'Slovenia', flag: '\u{1F1F8}\u{1F1EE}', co2: 13200000, isCountry: true },
            { name: 'Lithuania', flag: '\u{1F1F1}\u{1F1F9}', co2: 14100000, isCountry: true },
            { name: 'Croatia', flag: '\u{1F1ED}\u{1F1F7}', co2: 17500000, isCountry: true },
            { name: 'Ireland', flag: '\u{1F1EE}\u{1F1EA}', co2: 37800000, isCountry: true },
        ];

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function getEmissionSeverity(rank) {
            if (rank <= 15) return 'emission-extreme';
            if (rank <= 50) return 'emission-high';
            if (rank <= 200) return 'emission-medium';
            if (rank <= 500) return 'emission-low';
            return 'emission-minimal';
        }

        function loadChart() {
            const config = viewConfig[currentView];
            const isNew = currentYear === '2024';
            const co2Field = isNew ? 'co2eq' : 'co2';
            const co2Label = isNew ? 'CO2-eq' : 'CO2';

            // Show/hide list sections based on current view
            document.getElementById('company-list-container').style.display =
                (currentView === 'company' && currentYear === '2024') ? 'block' : 'none';
            document.getElementById('country-list-container').style.display =
                (currentView === 'country') ? 'block' : 'none';

            // Check if view is available for selected year
            if (!config.available.includes(currentYear)) {
                if (chart) {
                    chart.destroy();
                    chart = null;
                }
                document.querySelector('.chart-wrapper').innerHTML =
                    `<p class="loading">${currentView === 'company' ? 'Company' : 'This'} data is only available for ${config.available.join(', ')}.</p>`;
                document.getElementById('chart-note').innerHTML = '';
                document.getElementById('subtitle').textContent = config.title(currentYear, co2Label);
                return;
            }

            // Restore canvas if needed
            if (!document.getElementById('chart')) {
                document.querySelector('.chart-wrapper').innerHTML = '<canvas id="chart"></canvas>';
            }

            document.getElementById('subtitle').textContent = config.title(currentYear, co2Label);
            document.getElementById('chart-note').innerHTML = notes[currentView];

            fetch(config.file(currentYear))
                .then(response => response.json())
                .then(data => {
                    const ctx = document.getElementById('chart').getContext('2d');

                    if (chart) {
                        chart.destroy();
                    }

                    chart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: data.map(d => d[config.labelField]),
                            datasets: [{
                                label: `${co2Label} Emissions (million tonnes)`,
                                data: data.map(d => (d[co2Field] || d.co2) / 1000000),
                                backgroundColor: colors.slice(0, data.length),
                                borderColor: colors.slice(0, data.length),
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const item = data[context.dataIndex];
                                            const emissions = item[co2Field] || item.co2;
                                            return [
                                                `${co2Label}: ${(emissions / 1000000).toFixed(2)} million tonnes`,
                                                `Ships: ${item.count.toLocaleString()}`
                                            ];
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    ticks: { color: '#888', maxRotation: 45, minRotation: 45 },
                                    grid: { color: 'rgba(255,255,255,0.1)' }
                                },
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        color: '#888',
                                        callback: function(value) { return value + ' M'; }
                                    },
                                    grid: { color: 'rgba(255,255,255,0.1)' },
                                    title: { display: true, text: `${co2Label} (million tonnes)`, color: '#888' }
                                }
                            }
                        }
                    });
                })
                .catch(error => {
                    document.querySelector('.chart-wrapper').innerHTML = '<p class="loading">Error loading data.</p>';
                });

            // Load list data for company/country views
            if (currentView === 'company' && currentYear === '2024') {
                loadCompanyList();
            }
            if (currentView === 'country') {
                loadCountryList();
            }
        }

        // ---- Company list ----
        function loadCompanyList() {
            fetch('json/2024_companies_all.json')
                .then(response => response.json())
                .then(data => {
                    allCompanies = data;
                    filteredCompanies = data;
                    companyPage = 1;
                    renderCompanyTable();
                })
                .catch(error => {
                    document.getElementById('company-tbody').innerHTML =
                        '<tr><td colspan="4">Error loading company data.</td></tr>';
                });
        }

        function renderCompanyTable() {
            const tbody = document.getElementById('company-tbody');
            const start = (companyPage - 1) * ROWS_PER_PAGE;
            const end = start + ROWS_PER_PAGE;

            const companiesWithRank = filteredCompanies.map((c, i) => ({
                ...c,
                rank: i + 1,
                co2: c.co2eq,
                isCountry: false
            }));

            const topCompanyEmissions = filteredCompanies.length > 0 ? filteredCompanies[0].co2eq : 0;
            const countriesSmaller = europeanCountryEmissions.filter(c => c.co2 < topCompanyEmissions);

            const merged = [...companiesWithRank, ...countriesSmaller]
                .sort((a, b) => b.co2 - a.co2);

            const pageData = merged.slice(start, end);

            tbody.innerHTML = pageData.map((item, index) => {
                const animDelay = `style="animation-delay: ${index * 0.02}s"`;

                if (item.isCountry) {
                    return `
                        <tr class="country-row" ${animDelay}>
                            <td class="rank"></td>
                            <td>${item.flag} ${escapeHtml(item.name)} <span class="country-label">country</span></td>
                            <td class="co2-value">${item.co2.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}</td>
                            <td>-</td>
                        </tr>
                    `;
                } else {
                    const severityClass = getEmissionSeverity(item.rank);
                    return `
                        <tr class="${severityClass}" ${animDelay}>
                            <td class="rank">${item.rank}</td>
                            <td>${escapeHtml(item.company)}</td>
                            <td class="co2-value">${item.co2.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                            <td>${item.count}</td>
                        </tr>
                    `;
                }
            }).join('');

            renderCompanyPagination(merged.length, countriesSmaller.length);
        }

        function renderCompanyPagination(totalItems, countryCount) {
            const total = totalItems || filteredCompanies.length;
            const countries = countryCount || 0;
            const totalPages = Math.ceil(total / ROWS_PER_PAGE);
            const pagination = document.getElementById('company-pagination');

            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            const countryText = countries > 0 ? ` + ${countries} countries` : '';
            pagination.innerHTML = `
                <button onclick="goToCompanyPage(${companyPage - 1})" ${companyPage === 1 ? 'disabled' : ''}>Previous</button>
                <span class="page-info">Page ${companyPage} of ${totalPages} (${filteredCompanies.length} companies${countryText})</span>
                <button onclick="goToCompanyPage(${companyPage + 1})" ${companyPage === totalPages ? 'disabled' : ''}>Next</button>
            `;
        }

        function goToCompanyPage(page) {
            const topCompanyEmissions = filteredCompanies.length > 0 ? filteredCompanies[0].co2eq : 0;
            const countriesCount = europeanCountryEmissions.filter(c => c.co2 < topCompanyEmissions).length;
            const totalPages = Math.ceil((filteredCompanies.length + countriesCount) / ROWS_PER_PAGE);
            if (page >= 1 && page <= totalPages) {
                companyPage = page;
                renderCompanyTable();
            }
        }

        document.getElementById('company-search').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            if (query === '') {
                filteredCompanies = allCompanies;
            } else {
                filteredCompanies = allCompanies.filter(c =>
                    c.company.toLowerCase().includes(query)
                );
            }
            companyPage = 1;
            renderCompanyTable();
        });

        // ---- Country list ----
        function loadCountryList() {
            const isNew = currentYear === '2024';
            const co2Field = isNew ? 'co2eq' : 'co2';
            const co2Label = isNew ? 'CO2-eq' : 'CO2';

            document.getElementById('country-list-title').textContent =
                `Top 20 Countries by ${co2Label} Emissions (${currentYear})`;
            document.getElementById('country-co2-header').textContent = `${co2Label} (tonnes)`;

            fetch(`json/${currentYear}_countries_top20.json`)
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('country-tbody');
                    tbody.innerHTML = data.map((item, index) => {
                        const emissions = item[co2Field] || item.co2;
                        const animDelay = `style="animation-delay: ${index * 0.02}s"`;
                        return `
                            <tr ${animDelay}>
                                <td class="rank">${index + 1}</td>
                                <td>${escapeHtml(item.country)}</td>
                                <td class="co2-value">${emissions.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                                <td>${item.count.toLocaleString()}</td>
                            </tr>
                        `;
                    }).join('');
                })
                .catch(error => {
                    document.getElementById('country-tbody').innerHTML =
                        '<tr><td colspan="4">Error loading country data.</td></tr>';
                });
        }

        // Tab click handlers
        document.querySelectorAll('.chart-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentView = tab.dataset.view;
                loadChart();
            });
        });

        // Year selector
        document.getElementById('year-select').addEventListener('change', (e) => {
            currentYear = e.target.value;
            loadChart();
        });

        // Initial load
        loadChart();
    </script>
</body>
</html>
